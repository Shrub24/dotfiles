import{_api_url,getStandardHeaders,parseResponse}from"./shared.js";export class EventSelectManager{constructor(e,t,n,s,i,o,a){this.targetID=e,this.selectedEventID=parseInt(t),this.selectedEventType=n,this.selectedEventName=s,this.required=i,this.label=o,this.onChange=a,this.lastEventType="",this.containerID=e+"-container",this.eventTypeID=e+"-event-type",this.dropdownID=e+"-dropdown",this.selectID=e+"-select",this.buttonID=e+"-button",this.inputGroupID=e+"-input-group",this.commission=0}getValue(){return parseInt(this.getSelectElement().val())}getEventType(){return $("#"+this.eventTypeID).val()}getCommission(){return this.commission}getSelectElement(){return $("#"+this.selectID)}getEventName(){return this.getSelectElement().select2("data")[0].text}select2(e){this.getSelectElement().select2(e)}open(){this.select2("open")}disable(){this.getSelectElement().prop("disabled",!0)}enable(){this.getSelectElement().prop("disabled",!1)}hide(){$("#"+this.targetID).hide()}show(){$("#"+this.targetID).show()}toggleEventType(e){e&&0!=e.length||(e="sport"),this.lastEventType=e}async init(){let e=`\n      <span id="${this.containerID}">\n\n        <div class="input-group mb-2 input-group-sm">\n            <span class="input-group-text" id="placed-label">Event Type</span>\n            <select id="${this.eventTypeID}" name="${this.eventTypeID}"\n              class="form-select form-select-sm"\n              value="sport"\n            >\n              <option value="sport">Sport</option>\n              <option value="horse">Horse</option>\n              <option value="greyhound">Greyhound</option>\n              <option value="harness">Harness</option>\n            </select>\n          </div>\n          <select\n            name="${this.targetID}-event-id"\n            id="${this.selectID}"\n            class="form-select"\n            style="font-weight: 400; line-height: 1.5;"\n          ></select>\n      </span>\n    `;$("#"+this.targetID).html(e),$("#"+this.eventTypeID+' option[value="'+this.selectedEventType+'"]').prop("selected",!0);const t=this;$("#"+t.eventTypeID).change((e=>{t.toggleEventType(this.getEventType()),t.open()})),this.toggleEventType(this.selectedEventType),1>this.selectedEventID&&$(`#${this.dropdownID} li`).click((function(){$(this).text()!=t.lastEventType&&$("#"+t.selectID).val("").trigger("change")}));let n=$("#"+this.targetID);const s=await getStandardHeaders();if($("#"+this.selectID).select2({placeholder:"Search for an event...",theme:"bootstrap-5",dropdownAutoWidth:!1,dropdownParent:n,scrollAfterSelect:!0,allowClear:!0,language:{noResults:function(){return"No events found"},errorLoading:function(){return"Please enter 3 or more characters."}},beforeSend:function(e){const t=getStandardHeaders();for(const n in t)e.setRequestHeader(n,t[n])},ajax:{url:_api_url+"/event/options",dataType:"json",type:"GET",delay:300,headers:function(e){const t={};for(const[n,s]of e.entries())t[n]=s;return t}(s),data:function(e){return(!e.term||e.term.length>=3)&&{query:e.term||"",type:t.getEventType(),event_id:t.selectedEventID,existing_event_type:t.selectedEventType}},cache:!0},templateResult:function(e){return e.id?$(`<span data-commission="${e.commission}">${e.text}</span>`):e.text}}),$("#"+this.selectID).on("change",(e=>{const n=$(e.target).select2("data")[0],s=n?.commission||0;t.commission=s,"function"==typeof t.onChange&&t.onChange(e,s)})),this.selectedEventID>0){var i=new Option(this.selectedEventName,this.selectedEventID,!0,!0);$("#"+this.selectID).append(i)}}}