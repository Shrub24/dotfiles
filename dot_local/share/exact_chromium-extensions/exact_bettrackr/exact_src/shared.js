/*!
 * BetTrackr Chrome Extension (c) 2025 BetTrackr Pty Ltd
 * Licensed for use with a valid BetTrackr account only.
 * Reverse engineering or modification is prohibited.
 */
const e="61:D5:4B:3D:5F:E0:8E:7F:19:7B";export const _host="https://bettrackr.com.au";export const _api_url=_host+"/bettrackr/api.pma/v1";export async function getStandardHeaders(){const t=new Headers;return t.append("X-App-Key",e),t.append("Authorization","Bearer "+await getToken()),t.append("Content-Type","application/json"),t}export function formatCurrency(e){return new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",minimumFractionDigits:2}).format(e)}export async function isLoggedIn(){return new Promise((e=>{chrome.storage.local.get(["bettrackrToken","bettrackrUser"],(t=>{t.bettrackrToken&&t.bettrackrUser?e(!0):e(!1)}))}))}export async function logout(){return new Promise((e=>{chrome.storage.local.clear((()=>{location.href="./layout.html?page=login&reason=loggedout",e()}))}))}export async function parseResponse(e){if(!e.ok){const t=Error(`HTTP ${e.status}: ${e.statusText}`);throw t.status=e.status,t}const t=await e.json();return t.success,t}export async function getToken(){return new Promise(((e,t)=>{chrome.storage.local.get(["bettrackrToken"],(async a=>{a.bettrackrToken?e(a.bettrackrToken):t("No Token")}))}))}export async function getUser(){return new Promise(((e,t)=>{chrome.storage.local.get(["bettrackrUser"],(async a=>{a.bettrackrUser?e(a.bettrackrUser):t("No User")}))}))}export async function fetchToken(t,a){const n=new FormData;n.append("login",t),n.append("password",a);const r=_api_url+"/token",s=new Headers;s.append("X-App-Key",e);const o=await fetch(r,{method:"POST",body:n,headers:s});return await parseResponse(o)}export async function fetchUser(){const e=_api_url+"/user",t=await getStandardHeaders(),a=await fetch(e,{method:"GET",headers:t});return(await parseResponse(a)).user}export async function fetchEvent(e,t,a,n,r,s,o,c,i){const u=_api_url+"/event",p=await getStandardHeaders(),d=new URLSearchParams;null!=e&&d.append("is_racing",e?"1":"0"),null!=t&&d.append("event_id",t),null!=a&&d.append("betfair_market_id",a),null!=n&&d.append("track",n),null!=r&&d.append("runner",r),null!=s&&d.append("event_name",s),null!=o&&d.append("event_date",o),null!=c&&d.append("sport",c),null!=i&&d.append("bookmaker",i);const l=`${u}?${d.toString()}`,h=await fetch(l,{method:"GET",headers:p});return await parseResponse(h)}export async function fetchBetTypes(){const e=_api_url+"/bet/types";return await t("betTypes",(async function(){const t=await getStandardHeaders(),a=await fetch(e,{method:"GET",headers:t});return(await parseResponse(a)).types}),864e5)}export async function getBet(e){const t=_api_url+"/bet/"+e,a=await getStandardHeaders(),n=await fetch(t,{method:"GET",headers:a});return(await parseResponse(n)).bet}export async function editBet(e){const t=await getBet(e);chrome.storage.local.set({bettrackrBetData:t,page:"bet"},(()=>{location.href="./layout.html?page=bet"}))}export async function fetchBetStatuses(){const e=_api_url+"/bet/statuses";return await t("betStatuses",(async function(){const t=await getStandardHeaders(),a=await fetch(e,{method:"GET",headers:t});return(await parseResponse(a)).statuses}),864e5)}export async function fetchRecentBets(){const e=_api_url+"/bet",t=await getStandardHeaders(),a=await fetch(e,{method:"GET",headers:t});return(await parseResponse(a)).bets}export async function fetchCalendarData(e,t,a,n){const r=new URLSearchParams({year:t.toString(),month:a.toString(),date:n.toString(),mode:e}),s=`${_api_url}/calendar?${r.toString()}`,o=await getStandardHeaders(),c=await fetch(s,{method:"GET",headers:o});return(await parseResponse(c)).data}export async function fetchRunners(e,t){const a="sport"==t.toLowerCase()?"sport_event_id":"racing_event_id",n=new URLSearchParams({[a]:e}),r=`${_api_url}/event/runners?${n.toString()}`,s=await getStandardHeaders(),o=await fetch(r,{method:"GET",headers:s});return(await parseResponse(o)).runners}export async function fetchPendingBets(){const e=_api_url+"/bet?pending=true",t=await getStandardHeaders(),a=await fetch(e,{method:"GET",headers:t});return(await parseResponse(a)).bets}export async function fetchBookmakerAccounts(){const e=_api_url+"/bookmakeraccount",t=await getStandardHeaders(),a=await fetch(e,{method:"GET",headers:t});return(await parseResponse(a)).bookmaker_accounts}export async function updateBetStatus(e,t,a){const n=_api_url+"/bet/"+e,r={status:t,date_resulted:a},s=await getStandardHeaders(),o=await fetch(n,{method:"PUT",headers:s,body:JSON.stringify(r)});return await parseResponse(o)}export async function getEvent(e,t,a,n,r,s){const o=_api_url+"/event",c=e?"racing_event_id":"sport_event_id",i={is_racing:e,[c]:t,betfair_market_id:a,track:n,runner:r,event_name:s},u=await getStandardHeaders(),p=await fetch(o,{method:"PUT",headers:u,body:JSON.stringify(i)});return await parseResponse(p)}export async function updateBetSelection(e,t){const a=_api_url+"/bet/"+e,n={selection:t},r=await getStandardHeaders(),s=await fetch(a,{method:"PUT",headers:r,body:JSON.stringify(n)});return await parseResponse(s)}export async function updateBookmakerBalance(e,t){const a=_api_url+"/bookmakeraccount/"+e,n={balance:t},r=await getStandardHeaders(),s=await fetch(a,{method:"PUT",headers:r,body:JSON.stringify(n)});return await parseResponse(s)}export async function createBet(e){const t=_api_url+"/bet",a=await getStandardHeaders(),n=await fetch(t,{method:"POST",headers:a,body:JSON.stringify(e)});return await parseResponse(n)}export async function updateBet(e){const t=_api_url+"/bet/"+e.bet_id,a=await getStandardHeaders(),n=await fetch(t,{method:"PUT",headers:a,body:JSON.stringify(e)});return await parseResponse(n)}export function reloadCurrentTab(){chrome.tabs.query({active:!0,currentWindow:!0},(function(e){e[0]&&chrome.tabs.reload(e[0].id)}))}export function getSpinner(){return'<div id="bettrackr-spinner" class="d-flex justify-content-center my-4"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></div>'}export async function setUser(e){chrome.storage.local.set({bettrackrUser:e})}export async function updateUser(){setUser(await fetchUser())}export function getClassFromStatus(e,t){switch(t){case"Won":return e+"-success";case"Lost":return e+"-danger";case"Cashed Out":return e+"-info";case"Void":return e+"-secondary";case"Pending":return e+"-warning";case"Bonus Cash Refund":case"Bonus Refund":return e+"-primary";default:return e+"-body"}}export function getProfitColourClass(e){return e>0?"profit-text":0>e?"loss-text":""}export async function importBonusbank(e,t,a){const n=_api_url+"/bet/import",r=await getStandardHeaders(),s=await fetch(n,{method:"POST",headers:r,body:JSON.stringify({tool:e,data:t,mode:"bonusbank",tool_mode:a})});return await parseResponse(s)}export function cloneAndReplace(e){const t=$(e).clone(!0);e.replaceWith(t)}export function renderTooltips(){document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach((function(e){new bootstrap.Tooltip(e)}))}async function t(e,t,a){const n=e+"CheckedAt",r=Date.now();return a&&parseInt(a)>=1||(a=36e5),new Promise((s=>{chrome.storage.local.get([e,n],(async o=>{const c=o[e];if(c&&r-o[n]<a)return s(c);try{const a=await t();chrome.storage.local.set({[e]:a,[n]:r}),s(a)}catch(e){s(null)}}))}))}export async function getLatestVersionCached(){const e=_host+"/app.pma/extensionVersion";return await t("latestVersion",(async function(){return await $.get(e)}))}export async function checkLatestVersion(){const e=chrome.runtime.getManifest().version;try{if(function(e,t){const a=e.split(".").map(Number),n=t.split(".").map(Number),r=Math.max(a.length,n.length);for(let e=0;r>e;e++){const t=a[e]||0,r=n[e]||0;if(t>r)return 1;if(r>t)return-1}return 0}(e,await getLatestVersionCached())>=0)return!0}catch(e){}return!1}