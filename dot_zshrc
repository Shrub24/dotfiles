# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# >>> conda initialize >>>
# !! Contents within this block are managed by 'conda init' !!
__conda_setup="$('/home/saurabhj/miniforge3/bin/conda' 'shell.bash' 'hook' 2> /dev/null)"
if [ $? -eq 0 ]; then
    eval "$__conda_setup"
else
    if [ -f "/home/saurabhj/miniforge3/etc/profile.d/conda.sh" ]; then
        . "/home/saurabhj/miniforge3/etc/profile.d/conda.sh"
    else
        export PATH="/home/saurabhj/miniforge3/bin:$PATH"
    fi
fi
unset __conda_setup
# <<< conda initialize <<<

# ZSH_THEME="powerlevel10k/powerlevel10k"

# ZFUNCDIR=${ZDOTDIR:-$HOME}/functions
# fpath=($ZFUNCDIR $fpath)
# autoload -Uz $fpath[1]/*(.:t)

source /usr/share/zsh-antidote/antidote.zsh
antidote load

zstyle :omz:plugins:ssh-agent quiet yes

# Configure OMZ plugins with scripts in conf.d.
for zlib in ${ZDOTDIR:-$HOME}/conf.d/*.zsh; source $zlib
unset zlib

alias nano="nvim"
alias edit="nvim"
alias vim="nvim"
alias vi="nvim"
alias cd="z"
alias ls="eza"
alias find="fd"
alias cat="bat"
alias grep="rg"


# Path to your Oh My Zsh installation.
# export ZSH="$HOME/.oh-my-zsh"


# Uncomment the following line if you want to disable marking untracked files
# under VCS as dirty. This makes repository status check for large repositories
# much, much faster.
# DISABLE_UNTRACKED_FILES_DIRTY="true"

# Uncomment the following line if you want to change the command execution time
# stamp shown in the history command output.
# You can set one of the optional three formats:
# "mm/dd/yyyy"|"dd.mm.yyyy"|"yyyy-mm-dd"
# or set a custom format using the strftime function format specifications,
# see 'man strftime' for details.
# HIST_STAMPS="mm/dd/yyyy"

# Would you like to use another custom folder than $ZSH/custom?
# ZSH_CUSTOM=/path/to/new-custom-folder

# Which plugins would you like to load?
# Standard plugins can be found in $ZSH/plugins/
# Custom plugins may be added to $ZSH_CUSTOM/plugins/
# Example format: plugins=(rails git textmate ruby lighthouse)
# Add wisely, as too many plugins slow down shell startup.
#plugins=(
#	git
#	zsh-shift-select
#	zsh-autosuggestions
#	zsh-bat
#	zsh-syntax-highlighting
#	you-should-use 
#)

# source $ZSH/oh-my-zs
# User configuration

# export MANPATH="/usr/local/man:$MANPATH"

# You may need to manually set your language environment
# export LANG=en_US.UTF-8

# Preferred editor for local and remote sessions
# if [[ -n $SSH_CONNECTION ]]; then
#   export EDITOR='vim'
# else
#   export EDITOR='nvim'
# fi

# Compilation flags
# export ARCHFLAGS="-arch $(uname -m)"

# Set personal aliases, overriding those provided by Oh My Zsh libs,
# plugins, and themes. Aliases can be placed here, though Oh My Zsh
# users are encouraged to define aliases within a top-level file in
# the $ZSH_CUSTOM folder, with .zsh extension. Examples:
# - $ZSH_CUSTOM/aliases.zsh
# - $ZSH_CUSTOM/macos.zsh
# For a full list of active aliases, run `alias`.
#
# Example aliases
# alias zshconfig="mate ~/.zshrc"
# alias ohmyzsh="mate ~/.oh-my-zsh"
# source ~/powerlevel10k/powerlevel10k.zsh-theme

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

. "$HOME/.local/bin/env"
eval "$(uv generate-shell-completion zsh)"
eval "$(uvx --generate-shell-completion zsh)"

if [[ -t 0 ]]; then
  stty -ixon
fi

bindkey '^W' clear-screen
bindkey '\t\t' autosuggest-accept

export GITHUB_USERNAME=Shrub24
export EDITOR=nvim


fzf-zoxide-insert-widget() {
  # 1. Fetch directories from zoxide
  # 2. Use fzf with a preview window (optional, requires eza/ls)
  local selected_dir=$(zoxide query -l | fzf \
    --height=40% \
    --layout=reverse \
    --border \
    --prompt="Insert Path > " \
    --preview 'eza --tree --level=1 --color=always {} 2>/dev/null || ls -1 --color=always {}' \
    --preview-window=right:40%:wrap)

  if [[ -n "$selected_dir" ]]; then
    # Check if we need to add a leading space
    # (If buffer is not empty and doesn't end with a space)
    if [[ -n "$LBUFFER" && "$LBUFFER" != *" " ]]; then
      LBUFFER+=" "
    fi
    
    # Append the directory
    LBUFFER+="${selected_dir}"
  fi

  zle redisplay
}

zle -N fzf-zoxide-insert-widget

# Binding: Keeping your preference, but standard is usually Alt-c or similar
bindkey -M viins '^f' fzf-zoxide-insert-widget
bindkey -M vicmd '^f' fzf-zoxide-insert-widget

function zvm_after_init() {
  # 1. Bind your Custom Zoxide Widget (Insert Mode)
  zvm_bindkey viins '^e' fzf-zoxide-insert-widget
  
  # 2. Restore Standard FZF bindings (Files & History)
  # These often get killed by vi-mode. We explicitly bring them back.
  
  # Ctrl+T = FZF File Search (Insert Mode)
  if zle -l fzf-file-widget; then
    zvm_bindkey viins '^t' fzf-file-widget
  fi

  # Ctrl+R = FZF History Search (Insert Mode)
  if zle -l fzf-history-widget; then
    zvm_bindkey viins '^r' fzf-history-widget
  fi
  
  # 3. Optional: Fix Autosuggestions (Accept with Ctrl+Space or Ctrl+f)
  # if type autosuggest-accept > /dev/null; then
  #   zvm_bindkey viins '^f' autosuggest-accept
  # fi
}

eval "$(zoxide init zsh)"

source <(fzf --zsh)

# pnpm
export PNPM_HOME="/home/saurabhj/.local/share/pnpm"
case ":$PATH:" in
  *":$PNPM_HOME:"*) ;;
  *) export PATH="$PNPM_HOME:$PATH" ;;
esac
# pnpm end
